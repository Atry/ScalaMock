<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="RSS feed for this page"/>

    <title>ScalaMock - Quick Start</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/assets/css/style.css" rel="stylesheet">
    <link href="/assets/css/highligh-js-styles/default.css" rel="stylesheet" >
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="/assets/js/modernizr.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-56676479-1', 'auto');
      ga('send', 'pageview');
   </script>
</head>


    <body>
        <!-- Fixed navbar -->
<div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">ScalaMock</a>
    </div>
    <div class="navbar-collapse collapse navbar-right">
      <ul class="nav navbar-nav">
        <li ><a href="/">Home</a></li>
        <li ><a href="/news/">News</a></li>
        <li class="active"><a href="/quick-start/">Quick Start</a></li>
        <li ><a href="/user-guide/">User Guide</a></li>
        <li ><a href="/roadmap/">Roadmap</a></li>
        <li ><a href="/feedback/">Feedback</a></li>
        <li><a href="http://github.com/paulbutcher/scalamock">Github</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>


            <div id="blue">
    <div class="container">
        <div class="row">
            <h3>Quick Start</h3>
        </div><!-- /row -->
    </div> <!-- /container -->
</div><!-- /blue -->
    

<div class="container mb" id="main-content">
    <div class="row">

        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 col-lg-push-8 col-md-push-8" id="sidebar">
    
    

    
        
        
    

    <h4><a href="/user-guide/">Quick Start index</a></h4>
    <div class="hline"></div>


    <ul class="page-index">
    
    </ul>

    
        <ul><li class="toc_level-1 toc_section-1"><a href="#installation"><span class="toctext">Installation</span></a></li><li class="toc_level-1 toc_section-2"><a href="#leaderboad-example"><span class="toctext">Leaderboad example</span></a><ul><li class="toc_level-2 toc_section-3"><a href="#objects-interacting-with-tested-class"><span class="toctext">Objects interacting with tested class</span></a></li><li class="toc_level-2 toc_section-4"><a href="#stubbing-objects-interacting-with-tested-class"><span class="toctext">Stubbing objects interacting with tested class</span></a></li><li class="toc_level-2 toc_section-5"><a href="#mocking-objects-interacting-with-tested-class"><span class="toctext">Mocking objects interacting with tested class</span></a></li><li class="toc_level-2 toc_section-6"><a href="#testing-with-scalamock"><span class="toctext">Testing with ScalaMock</span></a></li></ul></li><li class="toc_level-1 toc_section-7"><a href="#further-reading"><span class="toctext">Further reading</span></a></li></ul>
    


</div>


        <! -- BLOG POSTS LIST -->
        <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8 col-lg-pull-4 col-md-pull-4">
            <p>This article describes how to use ScalaMock in your tests. Because it is just an introduction to ScalaMock, it describes only the basic usage of this mocking framework. For more details please refer to the <a href="/user-guide/">User Guide</a>.</p>

<h2 id="installation">Installation</h2>

<p>To use ScalaMock in <a href="http://www.scala-sbt.org/">sbt</a> with <a href="http://www.scalatest.org/">ScalaTest</a> add the following to your project file:</p>

<pre><code class="language-scala">libraryDependencies += "org.scalamock" %% "scalamock-scalatest-support" % "3.4.2" % Test
</code></pre>

<p>If you don’t use sbt or ScalaTest please check the <a href="/user-guide/installation/">Installation</a> chapter in the User Guide.</p>

<p>The sample code described in this article is available on <a href="http://github.com/pawel-wiejacha/scalamock-examples">GitHub</a>.</p>

<h2 id="leaderboad-example">Leaderboad example</h2>

<p>This example assumes that we’re writing code that is responsible for updating a Country Leaderboard (i.e. <em>Top Countries</em>) every time a match between two players finishes in an online multiplayer game. </p>

<p>They say that picture is worth a thousand words, so before we get into details let’s look at a diagram:</p>

<p><img src="/assets/img/sm_qs_leaderboard.png" alt="Diagram" /></p>

<p>The <code>Player</code> class represents a player and <code>MatchResult</code> describes the result of a played game between two players. Each player has its unique id and country it came from:</p>

<pre><code class="language-scala">type PlayerId = Int
case class Player(id: PlayerId, nickname: String, country: Country)
case class MatchResult(winner: PlayerId, loser: PlayerId)
</code></pre>

<p>There is also the <code>CountryLeaderboard</code> trait that describes the Country Leaderboard interface:</p>

<pre><code class="language-scala">case class CountryLeaderboardEntry(country: Country, points: Int)

trait CountryLeaderboard {
  def addVictoryForCountry(country: Country): Unit
  def getTopCountries(): List[CountryLeaderboardEntry]
}
</code></pre>

<p>The class we are going to test is called <code>MatchResultObserver</code> since its responsibility is to observe created <code>MatchResult</code> instances:</p>

<pre><code class="language-scala">class MatchResultObserver(playerDatabase: PlayerDatabase, countryLeaderBoard: CountryLeaderboard) {
  def recordMatchResult(result: MatchResult): Unit = {
    val player = playerDatabase.getPlayerById(result.winner)
    countryLeaderBoard.addVictoryForCountry(player.country)
  }
}
</code></pre>

<p>Finally, there is the <code>PlayerDatabase</code> trait that provides an abstract interface for accessing player information from some database:</p>

<pre><code class="language-scala">trait PlayerDatabase {
  def getPlayerById(playerId: PlayerId): Player
}
</code></pre>

<p>As mentioned before, the <code>MatchResultObserver</code> is the class we are going to test. We assume that all classes that implement <code>PlayerDatabase</code> and <code>CountryLeaderboard</code> traits are tested in different test suites.</p>

<h3 id="objects-interacting-with-tested-class">Objects interacting with tested class</h3>

<p><code>MatchResultObserver</code> is a very simple class and it should be easy to test it. Unfortunately the only available implementation of <code>PlayerDatabase</code> is one that uses some relational database to store and retrieve players:</p>

<pre><code class="language-scala">class RealPlayerDatabase(
  dbConnectionPool: DbConnectionPool,
  databaseConfig: DatabaseConfig,
  securityManager: SecurityManager,
  transactionManager: TransactionManager) extends PlayerDatabase {

  override def getPlayerById(playerId: PlayerId) = ???
}
</code></pre>

<p>It would be a nightmare to setup a database, fill it with sample players, create all of <code>RealPlayerDatabase</code>’s dependencies (like <code>TransactionManager</code>) and the dependencies of those dependencies. </p>

<p>Fortunately, mocking is useful in this kind of situation because instead of testing <code>MatchResultObserver</code> with <code>RealPlayerDatabase</code> we can test it with a much simpler <code>PlayerDatabase</code> implementation. We could directly implement <code>PlayerDatabase</code>, for example:</p>

<pre><code>class FakePlayerDatabase extends PlayerDatabase {
    override def getPlayerById(playerId: PlayerId) : Player = {
        if (playerId == 222) return Player(222, "boris", Countries.Russia)
        else if (playerId == 333) return Player(333, "hans", Countries.Germany)
        else ???
    }
}
</code></pre>

<p>In this case it does not look that bad. But implementing complex traits or having a fake implementation generic enough to handle all test cases can be a really cumbersome and error-prone task.</p>

<p>This is where ScalaMock comes into play.</p>

<h3 id="stubbing-objects-interacting-with-tested-class">Stubbing objects interacting with tested class</h3>

<p>With ScalaMock you can create objects that pretend to implement some trait or interface. Then you can instruct that “faked” object how it should respond to all interactions with it. For example:</p>

<pre><code class="language-scala">// create fakeDb stub that implements PlayerDatabase trait
val fakeDb = stub[PlayerDatabase] 

// configure fakeDb behavior 
(fakeDb.getPlayerById _) when(222) returns(Player(222, "boris", Countries.Russia))
(fakeDb.getPlayerById _) when(333) returns(Player(333, "hans", Countries.Germany))

// use fakeDb
assert(fakeDb.getPlayerById(222).nickname == "boris")
</code></pre>

<h3 id="mocking-objects-interacting-with-tested-class">Mocking objects interacting with tested class</h3>

<p>ScalaMock supports both two mocking styles: <em>Expectations-First Style</em> (mocks) and <em>Record-then-Verify</em> (stubs). <br />
Previously we used a stub to create a fake <code>PlayerDatabase</code> and now we will use a mock <code>CountryLeaderboard</code> to set our test expectations:</p>

<pre><code class="language-scala">// create CountryLeaderboard mock
val countryLeaderBoardMock = mock[CountryLeaderboard]

// set expectations
(countryLeaderBoardMock.addVictoryForCountry _).expects(Countries.Germany)

// use countryLeaderBoardMock
countryLeaderBoardMock.addVictoryForCountry(Countries.Germany) // OK
countryLeaderBoardMock.addVictoryForCountry(Countries.Russia)  // throws TestFailedException
</code></pre>

<p>To read more about the differences between mocks and stubs please check <a href="/user-guide/mocking_style/">Choosing your mocking style</a> chapter in the User Guide.</p>

<h3 id="testing-with-scalamock">Testing with ScalaMock</h3>

<p>To provide mocking support in ScalaTest suites just mix your suite with <code>org.scalamock.scalatest.MockFactory</code>:</p>

<pre><code class="language-scala">import org.scalamock.scalatest.MockFactory
import org.scalatest.FlatSpec

class MatchResultObserverTest extends FlatSpec with MockFactory {

  val winner = Player(id = 222, nickname = "boris", country = Countries.Russia)
  val loser = Player(id = 333, nickname = "hans", country = Countries.Germany)

  "MatchResultObserver" should "update CountryLeaderBoard after finished match" in {
    val countryLeaderBoardMock = mock[CountryLeaderboard]
    val userDetailsServiceStub = stub[PlayerDatabase]

    // set expectations
    (countryLeaderBoardMock.addVictoryForCountry _).expects(Countries.Russia)

    // configure stubs
    (userDetailsServiceStub.getPlayerById _).when(loser.id).returns(loser)
    (userDetailsServiceStub.getPlayerById _).when(winner.id).returns(winner)

    // run system under test
    val matchResultObserver = new MatchResultObserver(userDetailsServiceStub, countryLeaderBoardMock)
    matchResultObserver.recordMatchResult(MatchResult(winner = winner.id, loser = loser.id))
  }
}
</code></pre>

<p>To use ScalaMock with different testing frameworks please check the <a href="/user-guide/integration/">Integration with testing frameworks</a> chapter in the User Guide.</p>

<h2 id="further-reading">Further reading</h2>

<p>ScalaMock has many powerful <a href="/user-guide/features/">features</a>. The example below shows some of them:</p>

<pre><code class="language-scala">val httpClient = mock[HttpClient]
val counterMock = mock[Counter]

inAnyOrder {
  (httpClient.sendRequest _).expects(Method.GET, *, *).twice
  (httpClient.sendRequest _).expects(Method.POST, "http://scalamock.org", *).noMoreThanOnce
  (httpClient.sendRequest _).expects(Method.POST, "http://example.com", *).returning(Http.NotFound)
  inSequence {
    (counterMock.increment _) expects(*) onCall { arg: Int =&gt; arg + 1}
    (counterMock.decrement _) expects(*) onCall { throw new RuntimeException() }
  }
}
</code></pre>

<p>Please read the <a href="/user-guide/">User Guide</a> for more details.</p>

        </div><! --/col-lg-8 -->


    </div><! --/row -->
</div><! --/container -->


        <!--
<div id="footerwrap">
    <div class="container">
        <p>ScalaMock - native Scala mocking framework</p>
    </div>
</div>
-->
<!-- based on https://github.com/st4ple/solid-jekyll -->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    </body>
</html>
